<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Post a Bike Ride - Share My Ride</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='logo.svg') }}" alt="Share My Ride logo" />
    <nav>
      <a href="{{ url_for('main.dashboard') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="{{ url_for('main.notifications') }}"><i class="fas fa-bell"></i> Notifications</a>
      <a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <main class="container form-container animate-fade-in-up">
    <h2><i class="fas fa-plus-circle"></i> Post a New Bike Ride</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for category, message in messages %}
            <li class="{{ category }}">
              <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'error' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
              {{ message }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form method="post" action="{{ url_for('rides.post_bike_ride') }}" novalidate>
      {{ form.hidden_tag() }}

      <div class="form-group">
        {{ form.source.label(class="form-label") }}
        {{ form.source(class="form-control", placeholder="e.g., Central Station", autocomplete="off") }}
      </div>

      <div class="form-group">
        {{ form.destination.label(class="form-label") }}
        {{ form.destination(class="form-control", placeholder="e.g., Airport Terminal 2", autocomplete="off") }}
      </div>

      <div class="form-group">
        {{ form.seats.label(class="form-label") }}
        {{ form.seats(class="form-control") }}
      </div>

      <div class="form-group">
        {{ form.ride_date.label(class="form-label") }}
        {{ form.ride_date(class="form-control") }}
      </div>

      <div class="form-group">
        {{ form.ride_time.label(class="form-label") }}
        {{ form.ride_time(class="form-control") }}
      </div>

      <div class="form-group">
        {{ form.ride_end_time.label(class="form-label") }}
        {{ form.ride_end_time(class="form-control") }}
        <small style="color: var(--color-neutral-500); font-size: var(--font-size-xs);">Optional. Use if your ride crosses midnight.</small>
      </div>

      <div class="form-group">
        {{ form.rider_gender_preference.label(class="form-label") }}
        {{ form.rider_gender_preference(class="form-control") }}
        <small style="color: var(--color-neutral-500); font-size: var(--font-size-xs);">Who are you comfortable riding with?</small>
      </div>

      <div class="form-group">
        {{ form.submit(class="btn btn-primary", id="post-ride-btn") }}
        <div class="spinner"></div>
      </div>
    </form>

    <a href="{{ url_for('main.dashboard') }}" class="btn btn-ghost" style="width: 100%; margin-top: var(--space-4); justify-content: center;">
      <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('form');
      const dateInput = document.getElementById('ride_date');
      const startTimeInput = document.getElementById('ride_time');
      const endTimeInput = document.getElementById('ride_end_time');
      const postBtn = document.getElementById('post-ride-btn');
      const btnContainer = postBtn.parentElement;

      // Set minimum date to today to prevent past dates
      const today = new Date().toISOString().split('T')[0];
      dateInput.setAttribute('min', today);

      // Client-side validation for time logic
      form.addEventListener('submit', function(e) {
        const startTime = startTimeInput.value;
        const endTime = endTimeInput.value;

        if (endTime && startTime >= endTime) {
          e.preventDefault(); // Stop form submission
          alert('End time must be later than the start time. If your ride crosses midnight, please adjust the end time accordingly.');
          return;
        }

        // Show loading state
        btnContainer.classList.add('loading');
        postBtn.disabled = true;
      });
    });
  </script>
</body>
</html>